{% extends 'store/base.html' %} {% load static %} {% block title %}Vista de
Productos{% endblock %} {% block content %}
<div class="container my-4">
  <h1 class="mb-4">Cat치logo de Productos 游꾹</h1>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Administraci칩n de Productos {{ filter_message }}</h2>
    <div>
      {% if show_clear_filter %}
      <a
        href="{% url 'admin-clear-branch-filter' %}"
        class="btn btn-warning me-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-list"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M9 6l11 0" />
          <path d="M9 12l11 0" />
          <path d="M9 18l11 0" />
          <path d="M5 6l0 .01" />
          <path d="M5 12l0 .01" />
          <path d="M5 18l0 .01" />
        </svg>
        Limpiar Filtro
      </a>
      {% endif %}
      <a
        href="{% url 'product-create' %}"
        class="btn btn-primary d-inline-flex align-items-center"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="me-2"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M12 5l0 14" />
          <path d="M5 12l14 0" />
        </svg>
        Crear Producto
      </a>
    </div>
  </div>

  <p class="text-muted">
    Esta tabla muestra los datos del cat치logo cargado desde el servicio.
  </p>

  <div class="table-responsive">
    <table class="table table-hover table-striped">
      <thead class="table-dark">
        <tr>
          <th class="text-center">ID</th>
          <th>Producto (T칤tulo)</th>
          <th>Descripci칩n</th>
          <th class="text-center">ID Categor칤a</th>
          <th class="text-center">Precio</th>
          <th class="text-center">Stock</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr class="align-middle">
          <td class="text-center">{{ product.id }}</td>
          <td>{{ product.title }}</td>
          <td>{{ product.description }}</td>
          <td class="text-center">{{ product.category_id }}</td>
          <td class="text-center">${{ product.price }}</td>
          <td class="text-center">{{ product.stock }}</td>

          <td class="d-flex justify-content-center gap-2">
            <a
              href="{% url 'product-edit' pk=product.id %}"
              title="Editar"
              class="btn btn-sm btn-info text-white"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"
                />
                <path
                  d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z"
                />
                <path d="M16 5l3 3" />
              </svg>
            </a>

            <form
              method="POST"
              action="{% url 'product-delete-html' pk=product.id %}"
              style="display: inline"
              onsubmit="return confirm('쮼st치s seguro de eliminar {{ product.title }}?')"
            >
              {% csrf_token %}
              <button
                type="submit"
                title="Eliminar"
                class="btn btn-sm btn-danger"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  <path d="M4 7l16 0" />
                  <path d="M10 11l0 6" />
                  <path d="M14 11l0 6" />
                  <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                  <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                </svg>
              </button>
            </form>
            <a
              href="{% url 'product-detail' pk=product.id %}"
              title="Ver Detalle"
              class="btn btn-sm btn-primary btn-view-detail"
              data-bs-toggle="modal"
              data-bs-target="#productDetailModal"
              data-product-id="{{ product.id }}"
              data-url="{% url 'product-detail-html' pk=product.id %}?modal=true"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                <path
                  d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6"
                />
              </svg>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center text-muted">
            No hay productos registrados.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div
  class="modal fade"
  id="productDetailModal"
  tabindex="-1"
  aria-labelledby="productDetailModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailModalLabel">
          Cargando Detalle...
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>
      <div class="modal-body" id="productDetailBody">
        <div class="text-center p-5">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block extra_styles %}
<style>
  .table td {
    vertical-align: middle; /* Centra verticalmente el contenido de la celda */
  }
  td:nth-child(3) {
    /* Selecciona la columna de Descripci칩n */
    max-width: 250px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
{% endblock extra_styles %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var productDetailModal = document.getElementById("productDetailModal");

    // Listener para cuando el modal se est치 abriendo
    productDetailModal.addEventListener("show.bs.modal", function (event) {
      var button = event.relatedTarget; // Bot칩n que dispar칩 el modal
      var detailUrl = button.getAttribute("data-url"); // La URL con ?modal=true

      var modalBody = productDetailModal.querySelector("#productDetailBody");
      var modalTitle = productDetailModal.querySelector(
        "#productDetailModalLabel"
      );

      // 1. Mostrar estado de carga y t칤tulo temporal
      modalBody.innerHTML =
        '<div class="text-center p-5"><div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div></div>';
      modalTitle.textContent = "Detalle del Producto";

      // 2. Cargar contenido v칤a AJAX
      fetch(detailUrl)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.text();
        })
        .then((html) => {
          // 3. Insertar el fragmento HTML cargado en el cuerpo del modal
          modalBody.innerHTML = html;
          // 4. Opcional: Actualizar el t칤tulo con el nombre del producto si es necesario
          // modalTitle.textContent = 'Detalle: ' + button.title;
        })
        .catch((error) => {
          // 5. Mostrar mensaje de error si la carga falla
          modalBody.innerHTML =
            '<div class="alert alert-danger">Error al cargar el detalle: ' +
            error.message +
            "</div>";
          console.error("Error fetching detail:", error);
        });
    });

    // Opcional: Limpiar el modal al cerrarse para evitar mostrar datos antiguos
    productDetailModal.addEventListener("hidden.bs.modal", function () {
      productDetailModal.querySelector("#productDetailBody").innerHTML = "";
    });
  });
</script>
{% endblock extra_js %}
