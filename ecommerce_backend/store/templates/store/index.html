{% extends 'store/base.html' %} {% load static %} {% block title %}Inicio{%endblock title %} {% block content %}
<div class="modal fade" id="branchSelectorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="branchSelectorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="branchSelectorModalLabel">Â¡Bienvenido! Elige tu Sucursal</h5>
                </div>
                <div class="modal-body">
                    <p>Para ver el stock y precios correctos, por favor selecciona tu sucursal:</p>
                    <div class="list-group">
                        {% for branch in branches %}
                        <button 
                            type="button" 
                            class="list-group-item list-group-item-action branch-select-btn"
                            data-branch-id="{{ branch.id }}"
                        >
                            <strong>{{ branch.name }}</strong><br>
                            <small class="text-muted">{{ branch.address }}</small>
                        </button>
                        {% endfor %}
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-danger" id="branchError" style="display:none;">Por favor, selecciona una sucursal.</small>
                    {% csrf_token %} 
                </div>
            </div>
        </div>
    </div>


  <div class="hero-section">
    <div
      id="carouselExampleAutoplaying"
      class="carousel slide hero-carousel"
      data-bs-ride="carousel"
      data-bs-interval="3000"
    >
      <div class="carousel-inner w-100 h-100">
        {% comment %} Nota: Ajusta la ruta estÃ¡tica si es necesario (ej:
        /media/productos/carrouselX.jpg) {% endcomment %} {# Item 1: Activo por
        defecto #}
        <div class="carousel-item active w-100 h-100">
          <img
            src="/media/productos/carrousel1.jpg"
            class="d-block w-100 hero-img-fixed"
            alt="Tortas de DiseÃ±o"
          />
          <div class="dark-overlay"></div>
        </div>

        {# Item 2 #}
        <div class="carousel-item w-100 h-100">
          <img
            src="/media/productos/carrousel2.jpg"
            class="d-block w-100 hero-img-fixed"
            alt="Desayunos Sorpresa"
          />
          <div class="dark-overlay"></div>
        </div>

        {# Item 3 #}
        <div class="carousel-item w-100 h-100">
          <img
            src="/media/productos/carrousel3.jpg"
            class="d-block w-100 hero-img-fixed"
            alt="Mesa Dulce Artesanal"
          />
          <div class="dark-overlay"></div>
        </div>

        {# Item 4 #}
        <div class="carousel-item w-100 h-100">
          <img
            src="/media/productos/carrousel4.jpg"
            class="d-block w-100 hero-img-fixed"
            alt="Promociones de la Semana"
          />
          <div class="dark-overlay"></div>
        </div>
      </div>
    </div>
    <div class="container hero-content">
      <div class="starter-template text-center py-5">
        <h2 class="mt-5 display-4 text-warning text-shadow-lg">
          Â¡Bienvenidos a Quiero Algo Dulce!
        </h2>
        <p class="lead text-light text-shadow-lg">
          Tu tienda online de reposterÃ­a artesanal.
        </p>
        <hr class="w-50 mx-auto border-warning" />

        <div class="text-white small mt-4 p-3 border rounded hero-info-box">
          <h3 class="mb-2 text-warning">Detalles del Proyecto</h3>
          <p class="mb-1">
            <em>Este es un sitio e-commerce construido con Django / Python.</em>
          </p>
          <hr class="my-2 border-secondary" />
          <p class="mb-0">Grupo: NÂ° <strong class="text-light"> </strong></p>
          <p class="mb-0">
            Universidad Nacional de Jujuy Facultad de Ingenieria
          </p>
        </div>
      </div>
    </div>
  </div>
  
<main role="main" class="container mt-3">
  <!-- SecciÃ³n de CategorÃ­as -->
  <h3 class="text-center mt-5 mb-4 text-warning">
    Explora Nuestras CategorÃ­as
  </h3>

  <div class="row g-4 justify-content-center pb-5">
    {% comment %} Tarjeta 1: Tortas {% endcomment %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <a href="{% url 'product-list' %}" class="text-decoration-none">
        <div
          class="card bg-secondary text-white shadow-lg h-100 transform hover:scale-105 transition duration-300"
        >
          <div
            class="card-header p-0 overflow-hidden bg-dark d-flex justify-content-center align-items-center"
            style="height: 150px"
          >
            <img
              class="img-fluid"
              src="{% static 'myapp/LogoQAD1.png' %} "
              alt="Tortas"
              style="object-fit: cover; width: 100%; height: 100%"
            />
          </div>
          <div class="card-body text-center">
            <h5 class="card-text fw-bold">Tortas</h5>
          </div>
        </div>
      </a>
    </div>

    {% comment %} Tarjeta 2: Desayunos {% endcomment %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <a href="{% url 'product-list' %}" class="text-decoration-none">
        <div
          class="card bg-secondary text-white shadow-lg h-100 transform hover:scale-105 transition duration-300"
        >
          <div
            class="card-header p-0 overflow-hidden bg-dark d-flex justify-content-center align-items-center"
            style="height: 150px"
          >
            <img
              class="img-fluid"
              src="{% static 'myapp/LogoQAD1.png' %} "
              alt="Desayunos"
              style="object-fit: cover; width: 100%; height: 100%"
            />
          </div>
          <div class="card-body text-center">
            <h5 class="card-text fw-bold">Desayunos</h5>
          </div>
        </div>
      </a>
    </div>

    {% comment %} Tarjeta 3: Catering {% endcomment %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <a href="{% url 'product-list' %}" class="text-decoration-none">
        <div
          class="card bg-secondary text-white shadow-lg h-100 transform hover:scale-105 transition duration-300"
        >
          <div
            class="card-header p-0 overflow-hidden bg-dark d-flex justify-content-center align-items-center"
            style="height: 150px"
          >
            <img
              class="img-fluid"
              src="{% static 'myapp/LogoQAD1.png' %} "
              alt="Catering"
              style="object-fit: cover; width: 100%; height: 100%"
            />
          </div>
          <div class="card-body text-center">
            <h5 class="card-text fw-bold">Catering</h5>
          </div>
        </div>
      </a>
    </div>

    {% comment %} Tarjeta 4: Tartas {% endcomment %}
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <a href="{% url 'product-list' %}" class="text-decoration-none">
        <div
          class="card bg-secondary text-white shadow-lg h-100 transform hover:scale-105 transition duration-300"
        >
          <div
            class="card-header p-0 overflow-hidden bg-dark d-flex justify-content-center align-items-center"
            style="height: 150px"
          >
            <img
              class="img-fluid"
              src="{% static 'myapp/LogoQAD1.png' %} "
              alt="Tartas"
              style="object-fit: cover; width: 100%; height: 100%"
            />
          </div>
          <div class="card-body text-center">
            <h5 class="card-text fw-bold">Tartas</h5>
          </div>
        </div>
      </a>
    </div>
  </div>
</main>

{% endblock content %} 
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Asegurate de que estas variables sean pasadas por el contexto
      var showModalStr = "{{ show_branch_modal|lower }}";
      var showModal = showModalStr === 'true';

      var modalElement = document.getElementById('branchSelectorModal');
      if (modalElement && showModal) {
        // INciar el modal
        var modal = new bootstrap.Modal(modalElement, {
          backdrop: 'static',
          keyboard: false // Evita cerrar con ESC
        });
        modal.show();
      }

      document.querySelectorAll('.branch-select-btn').forEach(button => {
        button.addEventListener('click', function() {
          var branchId = this.getAttribute('data-branch-id');
          var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

          document.querySelectorAll('.branch-select-btn').forEach(btn => btn.disabled = true);

          fetch("{% url 'set-branch' %}", {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
              'X-CSRFToken': csrfToken
            },
            body: `branch_id=${branchId}`
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              var modal = bootstrap.Modal.getInstance(modalElement);
              modal.hide();
              window.location.reload();
            } else {
              throw new Error( data.error || 'Error al establecer la sucursal');
            }
          })
          .catch(error => {
            document.getElementById('branchError').textContent = 'Error: ' + error.message;
            document.getElementById('branchError').style.display = 'block';
            document.querySelectorAll('.branch-select-btn').forEach(btn => btn.disabled = false);
          });
      });
    });
    });
</script>
{% endblock extra_js %}
{% block extra_styles %}
<style>
    /* 1. Contenedor Principal (Define el Ã¡rea del "Hero") */
    .hero-section {
        position: relative;
        min-height: 650px; /* Altura del carrusel */
        width: 100%;
        
        /* ðŸ’¡ SOLUCIÃ“N: Ajustar el margen superior para eliminar espacios innecesarios. */
        /* Si tu barra de navegaciÃ³n NO es fija, este ajuste puede ser necesario. */
        margin-top: 0; /* AsegÃºrate que no haya margen superior indeseado */
        
        display: flex;
        align-items: center; /* Centra verticalmente el contenido de bienvenida */
        justify-content: center;
        background-color: #333;
    }

    /* 2. Carrusel como Fondo */
    .hero-carousel {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1; 
    }

    /* 3. Imagen fija dentro del carrusel */
    .hero-img-fixed {
        object-fit: cover;
        height: 100%;
        filter: brightness(0.85);
    }

    /* 4. SuperposiciÃ³n Oscura (Refuerza el contraste) */
    .dark-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.2); 
        z-index: 2;
    }

    /* 5. Contenido de Bienvenida (Posicionado encima) */
    .hero-content {
        position: relative;
        z-index: 10; /* Debe estar por encima del carrusel y el overlay */
        max-width: 900px;
        color: white; 
    }
    
    /* 6. Mejorar legibilidad del texto */
    .text-shadow-lg {
        text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
    }
    
    /* Caja de informaciÃ³n del proyecto */
    .hero-info-box {
        background-color: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(5px);
        border-color: rgba(255, 255, 255, 0.3) !important;
    }

</style>
{% endblock extra_styles %}